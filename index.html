
<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1" />  
<title>Day Tracker Pro</title>  
<link rel="manifest" href="manifest.json" />  
<meta name="theme-color" content="#2563eb" />  
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  
<style> 

:root {  
  --primary: #FF9713;  
  --bg-light: #BCBCBC;  
  --bg-dark: #1f2937;  
  --text-light: #1f2937;  
  --text-dark: #f9fafb;  
  --overlay: rgba(0,0,0,0.6);  
  --card1:linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
  --card2: linear-gradient(135deg, #FFC123 0%, #ff5e62 100%);
  --card3:linear-gradient(125deg, #56ab2f 0%, #a8e063 100%);
  --card4:linear-gradient(135deg, #da22ff 0%, #979DFC 100%);
  --card5: linear-gradient(15deg, #43cea2 0%, #185a9d 100%);  
}  
:root {
  --text-primary: #222;
  --text-secondary: #555;
  --background: #fff;
  --separator-color: #999;
}

body.dark {
  --primary: #685DE7; 
  --text-primary: #eee;
  --text-secondary: #bbb;
  --background: #121212;
  --separator-color: #ACACAC;
 --card1:linear-gradient(145deg, #1a1a1a, #2d1b4e);
  --card2: linear-gradient(160deg, #0f2027, #203a43, #2c5364);
  --card3:linear-gradient(135deg, #0f2027, #1a2f1f, #203a43);
  --card4:linear-gradient(145deg, #1b0a0a, #3a1a1a);
  --card5:linear-gradient(135deg, #1e1e2f, #3b1f52);

}

/* Use variables in your CSS */
body {
  background-color: var(--background);
  color: var(--text-primary);
}













body {  
  margin: 0;  
  font-family: system-ui, sans-serif;  
  background: var(--bg-light);  
  color: var(--text-light);  
  transition: background 0.3s, color 0.3s;  

}  
body.dark {  
  background: var(--bg-dark);  
  color: var(--text-dark);  
}  
header {  
  background: var(--primary);  
  color: white;  
  padding: 0.8rem 1rem;  
  display: flex;  
  justify-content: space-between;  
  align-items: center;  
}  
header h1 { margin: 0; font-size: 1.2rem; }  
header .actions button {  
  background: none;  
  border: none;  
  color: white;  
  cursor: pointer;  
}  
nav {  display: flex;
overflow-x: auto;
background: white;
}
body.dark nav { background: #374151; }
nav .tab-btn {
padding: 0.68rem 0.7rem;
border: none;
background: none;
border-radius: 1px;
border-right:0.2px solid #72727291;
border-left:1px solid #72727291;
cursor: pointer;
margin-left: 0.2px;
}
body.dark nav .tab-btn { color: white;border-right:1px solid #5A5A5A;border-left:1px solid #72727291; }
nav .tab-btn.active {
background: var(--primary);
color: white;
}
.tab-close {
  margin-left: 30px;
  cursor: pointer;
  font-size: 1.2rem;
  
  color: #000000;
}
body.dark .tab-close {
margin-left: 30px;
cursor: pointer;
font-size:1.2rem;

color: #D1FF00;
}

.actions {
display: flex;
gap: 2rem;
align-items: center;
}

.action-btn {
display: flex;
flex-direction: column;
align-items: center;
cursor: pointer;
color: white;
position: relative;
}

.action-btn small {
font-size: 0.7rem;
margin-top: 2px;
opacity: 0.9;

/* Fix left margin or spacing /
margin-left: 0;
padding-left: 0;
text-align: center;
display: block; / make sure small acts like a block and centers properly */
width: 100%;
}

/* Hover tooltip */
.action-btn::after {
content: attr(title);
position: absolute;

bottom: -1.8rem;
background: rgba(0, 0, 0, 0.8);
color: white;
padding: 3px 2px;
border-radius: 4px;
font-size: 0.7rem;
white-space: nowrap;
opacity: 0;
pointer-events: none;
transition: opacity 0.2s ease;
}

.action-btn:hover::after {
opacity: 1;
}

.plus-tab { font-weight: bold;}
main { padding: 1rem; }

/* Dashboard */
.dashboard-grid {
display: grid;
gap: 1rem;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
}
.dashboard-card {
border-radius: 12px;
padding: 1rem;
color: white;
display: flex;
flex-direction: column;
box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  transition: background-color 0.4s ease-in-out;
  animation: cardEnter 0.5s ease forwards;
  opacity: 0;
  transform: translateY(50px);
}

/* Colors repeat every 5 cards */
.dashboard-card:nth-child(5n + 1) { background: var(--card1); }
.dashboard-card:nth-child(5n + 2) { background: var(--card2); }
.dashboard-card:nth-child(5n + 3) { background: var(--card3); }
.dashboard-card:nth-child(5n + 4) { background: var(--card4); }
.dashboard-card:nth-child(5n + 5) { background: var(--card5); }

/* Stagger delays for wave effect */

/* Slide + fade in animation */
@keyframes cardEnter {
  0% {
    opacity: 0;
    transform: translateY(50px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}


.card-progress {
  width: 100%;
  background: #eee;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  margin: 0.5rem 0;
}

.card-progress-bar {
  height: 100%;
  background: #10b981; /* green */
  transition: width 0.3s ease;
}

/* Tracker */
.progress-container { background: #ddd; border-radius: 10px; overflow: hidden; height: 10px; margin: 0.5rem 0; }
.progress-bar { background: var(--primary); height: 100%; width: 0; transition: width 0.4s ease; }
.week-title { font-weight: bold; margin-top: 1rem; }
label.checkbox {
display: flex; align-items: center; gap: 0.8rem;
background: #DFDFDF; padding: 0.7rem 1rem; border-radius: 12px;
cursor: pointer; margin-bottom: 0.5rem;
}
body.dark label.checkbox { background: #374151; }
input[type="checkbox"] { display: none; }
.checkmark {
width: 24px; height: 24px; background: #FFFFFF; border-radius: 6px;
position: relative; transition: background 0.3s;
}
input:checked + .checkmark { background: var(--primary); animation: pop 0.3s ease; }
@keyframes pop { 50% { transform: scale(1.3); } }
.checkmark svg {
position: absolute; top: 3px; left: 5px; width: 14px; height: 14px;
stroke: white; stroke-width: 3; fill: none; opacity: 0; transition: opacity 0.2s;
}
input:checked + .checkmark svg { opacity: 1; }

/* Modal with Floating Labels */
.modal-overlay {
position: fixed; top:0; left:0; right:0; bottom:0;
background: var(--overlay); display: none;
align-items: center; justify-content: center; z-index: 100;
}
.modal {
background: white; border-radius: 12px; padding: 1rem;
width: 90%; max-width: 400px; text-align: center;
}
body.dark .modal { background: #1f2937; color: white; }
.modal h2 { margin-top: 0; }
.form-group { position: relative; margin-top: 1.5rem; }
.modal input {
width: 96%; padding: 10px 10px 10px 5px;
border: none; border-bottom: 2px solid #ccc;
background: transparent; font-size: 1rem;
color: inherit;
}
.modal input:focus { outline: none; border-bottom: 2px solid var(--primary); }
.modal label {
position: absolute; top: 10px; left: 5px;
font-size: 1rem; color: #999;
transition: 0.3s ease all; pointer-events: none;
}
.modal input:focus ~ label,
.modal input:valid ~ label {
top: -10px; font-size: 0.8rem; color: var(--primary);
}
.modal button {
  
margin-top: 1rem; padding: 0.6rem; width: 45%; 
border-radius: 8px; font-size: 1rem;
background: var(--primary); color: white; border: none;
cursor: pointer;
}

.modal {
  position: relative; /* <-- ensure the modal is relatively positioned */
}

.modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 1.5rem;
  font-weight: bold;
  color: #999;
  cursor: pointer;
  transition: color 0.2s ease;
}

.modal-close:hover {
  color: #ff5555;
}






.modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 1.5rem;
}

.modal-buttons button {
  padding: 0.6rem 1rem;
  font-size: 1rem;
  border-radius: 8px;
  cursor: pointer;
  border: none;
}

/* Primary button: like Yes, Create */
.modal-buttons button[type="submit"] {
  background: var(--primary);
  color: white;
}

/* Cancel button */
.modal-buttons button.cancel-btn {
  background: transparent;
  border: 1px solid var(--primary);
  color: var(--primary);
}

.modal-buttons button.cancel-btn:hover {
  background: rgba(255, 124, 0, 0.1);
}







.card-buttons {
  display: flex;
  justify-content: space-between;
  gap: 0.8rem;
  margin-top: 0.8rem;
}

.card-buttons button {
  flex: 1;
  padding: 0.5rem;
  font-size: 0.9rem;
  border-radius: 8px;
  cursor: pointer;
  border: none;
}

/* Open = primary style */
.card-buttons .open-btn {
  background: var(--primary);
  color: white;
}

/* Reset = outlined subtle style */
.card-buttons .reset-btn {
  background: transparent;
  border: 1px solid white;
  color: white;
}

.card-buttons .reset-btn:hover {
  background: rgba(255, 255, 255, 0.15);
}



body:not(.dark) .card-buttons .reset-btn {
  color: var(--text-light);
  border-color: var(--text-light);
}

body:not(.dark) .card-buttons .reset-btn:hover {
  background: rgba(0, 0, 0, 0.05);
}

body:not(.dark) .card-buttons .open-btn {
  color: white;
  background: var(--primary);
}



.theme-toggle-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 0.75rem;
  gap: 0.2rem;
  margin-top: 0.5rem;
  color: var(--text-light);
}

body.dark .theme-toggle-wrapper small {
  color: var(--text-dark);
}

#themeToggle {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
}

#themeIcon svg {
  width: 100%;
  height: 100%;
}



#tabs-wrapper {
  display: flex;
  align-items: center;
  gap: 0.1rem;
  padding: 0 0; /* optional: some side padding */
  border-bottom: 1px solid var(--separator-color);
  background-color: var(--bg-primary);
}

#tabs {
  flex-grow: 1;
  display: flex;
  overflow-x: auto;
  white-space: nowrap;
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
}

/* Optional: Custom scrollbar for webkit browsers */
#tabs::-webkit-scrollbar {
  height: 6px;
}
#tabs::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
}
#tabs::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb);
  border-radius: 3px;
}

/* Plus button styles */
#addTabBtn {
  flex-shrink: 0;
  font-size: 1.5rem;
  padding: 0.48rem 1.2rem;
  cursor: pointer;
  background-color: #FFC635;
  border: none;
  box-shadow:-1px 0px 13px #7E7E7E;
  color: var(--btn-text);
  border-radius: 4px;
  transition: background-color 0.3s ease;
}
body.dark #addTabBtn{
background-color: #5F76EA;
box-shadow:-1px 0px 13px #7E7E7E;
}
#addTabBtn:hover {
  background-color: #EDC628;
}

/* Existing tab button styles should be compatible */








/* Celebration */
.celebration-popup {
position: fixed; top: 15%; left: 50%; transform: translateX(-50%);
background: var(--primary); color: white;
padding: 1rem 1.5rem; border-radius: 12px;
font-size: 1.1rem; opacity: 0; transition: opacity 0.3s;
z-index: 200;
}
.celebration-popup.show { opacity: 1; }
#confetti-canvas {
position: fixed; top:0; left:0; width:100%; height:100%;
pointer-events: none; z-index: 199;
}

</style>  
</head>  <script>  
if ("serviceWorker" in navigator) {  
  navigator.serviceWorker.register("./sw.js")  
    .then(() => console.log("✅ Service Worker registered"))  
    .catch((err) => console.error("SW registration failed:", err));  
}  
</script>  <body>  
<canvas id="confetti-canvas"></canvas>  <header>    <h1>Day Tracker</h1>  
  <div class="actions">  
<div class="theme-toggle-wrapper">
  <button id="themeToggle" onclick="toggleDarkMode()" aria-label="Toggle Theme">
    <span id="themeIcon"></span>
  </button>
  <small id="themeToggleLabel">Switch to Dark Mode</small>
</div>
    <div class="action-btn" onclick="exportData()" title="Export Data">  
      <span class="material-icons">file_upload</span>  
      <small>Export</small>  
    </div>  
    <div class="action-btn" onclick="importData()" title="Import Data">  
      <span class="material-icons">file_download</span>  
      <small>Import</small>  
    </div>  
    <div class="action-btn" id="resetBtn" style="display:none;" title="Reset">  
      <span class="material-icons">restart_alt</span>  
      <small>Reset</small>  
    </div>  
  </div>  
</header> <div id="tabs-wrapper">
  <nav id="tabs"></nav>
  <button id="addTabBtn" class="plus-tab">+</button>
</div>

<main id="content"></main>  <div class="modal-overlay" id="modalOverlay">  

<div class="modal" id="modalBox">
  <span class="modal-close" onclick="document.getElementById('modalOverlay').style.display='none'">&times;</span>
  <h2 id="modalTitle"></h2>
  <div id="modalBody"></div>
</div>
</div>  <div class="celebration-popup" id="celebrationPopup"></div>  <script>  

document.querySelectorAll('.dashboard-card').forEach((card, index) => {  
  card.style.setProperty('--i', index);  
});  
  
  
  
  
let allTabs = JSON.parse(localStorage.getItem('allTabs')) || { Dashboard: null };    
let currentTab = localStorage.getItem('currentTab') || 'Dashboard';    
let completedWeeks = JSON.parse(localStorage.getItem('completedWeeks')) || {};    
let completedTabs = JSON.parse(localStorage.getItem('completedTabs')) || {};    
    
function saveTabs() {    
  localStorage.setItem('allTabs', JSON.stringify(allTabs));    
  localStorage.setItem('currentTab', currentTab);    
  localStorage.setItem('completedWeeks', JSON.stringify(completedWeeks));    
  localStorage.setItem('completedTabs', JSON.stringify(completedTabs));    
}    
    
function toggleDarkMode() {  
  document.body.classList.toggle('dark');  
  const isDark = document.body.classList.contains('dark');  
  localStorage.setItem('darkMode', isDark);  
  updateThemeToggleLabel();  
}  
  
function updateThemeToggleLabel() {  
  const label = document.getElementById('themeToggleLabel');  
  const icon = document.getElementById('themeIcon');  
  const isDark = document.body.classList.contains('dark');  
    
  label.textContent = isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode';  
    
  icon.innerHTML = isDark ?  
    `<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="white" viewBox="0 0 24 24"><path d="M21.752 15.002a9.992 9.992 0 0 1-11.118-12.68 1 1 0 0 0-1.555-1.09A10.996 10.996 0 1 0 22.85 16.557a1 1 0 0 0-1.098-1.555Z"/></svg>` :  
    `<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="black" viewBox="0 0 24 24"><path d="M12 4.5a1 1 0 0 1-1-1V2a1 1 0 0 1 2 0v1.5a1 1 0 0 1-1 1Zm0 17a1 1 0 0 1-1-1V22a1 1 0 0 1 2 0v-1.5a1 1 0 0 1-1 1ZM4.5 13a1 1 0 0 1-1-1 1 1 0 0 1 0-2h1.5a1 1 0 0 1 0 2H4.5Zm14.5 0a1 1 0 0 1-1-1 1 1 0 0 1 0-2h1.5a1 1 0 0 1 0 2H19ZM6.22 6.22a1 1 0 0 1 1.42 0l1.06 1.06a1 1 0 1 1-1.42 1.42L6.22 7.64a1 1 0 0 1 0-1.42Zm10.1 10.1a1 1 0 0 1 1.42 0l1.06 1.06a1 1 0 0 1-1.42 1.42l-1.06-1.06a1 1 0 0 1 0-1.42ZM6.22 17.78a1 1 0 0 1 0-1.42l1.06-1.06a1 1 0 1 1 1.42 1.42L7.64 17.78a1 1 0 0 1-1.42 0Zm10.1-10.1a1 1 0 0 1 0-1.42l1.06-1.06a1 1 0 1 1 1.42 1.42l-1.06 1.06a1 1 0 0 1-1.42 0ZM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8Z"/></svg>`;  
}  
  
if (localStorage.getItem('darkMode') === 'true') {  
  document.body.classList.add('dark');  
}  
updateThemeToggleLabel(); // Call this after setting dark class  
  
  
  
  
function launchConfetti(intensity) {    
  const canvas = document.getElementById('confetti-canvas');    
  const ctx = canvas.getContext('2d');    
  canvas.width = window.innerWidth;    
  canvas.height = window.innerHeight;    
  let particles = [];    
  for (let i = 0; i < intensity; i++) {    
    particles.push({    
      x: Math.random() * canvas.width,    
      y: Math.random() * canvas.height - canvas.height,    
      r: Math.random() * 6 + 4,    
      d: Math.random() * intensity,    
      color: `hsl(${Math.random()*360}, 100%, 50%)`    
    });    
  }    
  function draw() {    
    ctx.clearRect(0, 0, canvas.width, canvas.height);    
    particles.forEach(p => {    
      ctx.beginPath();    
      ctx.fillStyle = p.color;    
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2, true);    
      ctx.fill();    
    });    
    update();    
  }    
  function update() {    
    particles.forEach(p => {    
      p.y += Math.cos(p.d) + 1 + p.r/2;    
      p.x += Math.sin(p.d);    
      if (p.y > canvas.height) {    
        p.x = Math.random() * canvas.width;    
        p.y = -10;    
      }    
    });    
  }    
  let interval = setInterval(draw, 20);    
  setTimeout(() => { clearInterval(interval); ctx.clearRect(0,0,canvas.width,canvas.height); }, 4000);    
}    
    
function showCelebrationPopup(message, full=false) {    
  const pop = document.getElementById('celebrationPopup');    
  pop.textContent = message;    
  pop.classList.add('show');    
  launchConfetti(full ? 200 : 60);    
  setTimeout(() => pop.classList.remove('show'), 3000);    
}    
    
function checkCelebrations(data) {    
  // Check each week    
  data.weeks.forEach((w, i) => {    
    const key = `${currentTab}-w${i}`;    
    const isComplete = w.every(d => d.checked);    
        
    if (isComplete && !completedWeeks[key]) {    
      // Mark as complete and celebrate    
      completedWeeks[key] = true;    
      saveTabs();    
      showCelebrationPopup(`Week ${i + 1} complete`, false);    
    }    
    else if (!isComplete && completedWeeks[key]) {    
      // Reset so it can celebrate again    
      completedWeeks[key] = false;    
      saveTabs();    
    }    
  });    
      
  // Check entire tab completion    
  const allComplete = data.weeks.every(w => w.every(d => d.checked));    
  if (allComplete && !completedTabs[currentTab]) {    
    completedTabs[currentTab] = true;    
    saveTabs();    
    showCelebrationPopup(`All done for ${currentTab}!`, true);    
  }    
  else if (!allComplete && completedTabs[currentTab]) {    
    completedTabs[currentTab] = false;    
    saveTabs();    
  }    
}    
    
function showModal(title, html, onSubmit) {    
    
  document.getElementById('modalTitle').textContent = title;    
  document.getElementById('modalBody').innerHTML = html;    
  document.getElementById('modalOverlay').style.display='flex';    
  const form = document.querySelector('#modalBody form');    
  if(form) form.onsubmit = e => { e.preventDefault(); onSubmit(new FormData(form)); document.getElementById('modalOverlay').style.display='none'; };    
}    
    
function createTrackerData(fd) {    
  const topic = fd.get('topic');    
  const days = parseInt(fd.get('days'));    
  const start = new Date(fd.get('startDate'));    
  const weeks = [];    
  let cur=[];    
  for(let i=0;i<days;i++){    
    const d=new Date(start);d.setDate(start.getDate()+i);    
    const lbl=`${d.toLocaleDateString('en-US',{weekday:'long'})} (${d.toLocaleDateString('en-GB')})`;    
    cur.push({label:lbl,checked:false});    
    if((i+1)%7===0||i===days-1){weeks.push(cur);cur=[];}    
  }    
  return {topic,weeks};    
}    
    
function renderTabs(){    
  const nav=document.getElementById('tabs');nav.innerHTML='';    
  const dash=document.createElement('button');dash.className='tab-btn'+(currentTab==='Dashboard'?' active':'');dash.textContent='Dashboard';    
  dash.onclick=()=>{currentTab='Dashboard';saveTabs();render();};nav.appendChild(dash);    
  Object.keys(allTabs).forEach(tab=>{    
    if(tab==='Dashboard') return;    
    const btn=document.createElement('button');btn.className='tab-btn'+(currentTab===tab?' active':'');btn.textContent=tab;    
    btn.onclick=()=>{currentTab=tab;saveTabs();render();};    
    const close=document.createElement('span');close.className='tab-close';close.textContent='×';    
    close.onclick=e=>{e.stopPropagation();showModal('Delete Tab', `  
  <form>  
    <p>All data will be erased for "${tab}". Are you sure?</p>  
    <div class="modal-buttons">  
  
      <button type="submit">Yes</button>  
          <button type="button" class="cancel-btn" onclick="document.getElementById('modalOverlay').style.display='none'">Cancel</button>  
    </div>  
  </form>  
`, () => {  
  delete allTabs[tab];  
  saveTabs();  
  if (currentTab === tab) currentTab = 'Dashboard';  
  render();  
});};    
    btn.appendChild(close);nav.appendChild(btn);    
  });    
  
}    
    
function renderDashboard(){    
  const c=document.getElementById('content');c.innerHTML='<div class="dashboard-grid"></div>';    
  const grid=c.querySelector('.dashboard-grid');    
  Object.keys(allTabs).forEach((tab,i)=>{    
    if(tab==='Dashboard'||!allTabs[tab])return;    
    const tr=allTabs[tab],total=tr.weeks.flat().length,done=tr.weeks.flat().filter(d=>d.checked).length;    
    const pct=Math.round(done/total*100);    
    const card=document.createElement('div');card.className='dashboard-card';    
card.innerHTML = `  
  <h3>${tab}</h3><p>${tr.topic}</p>  
  <div class="card-progress"><div class="card-progress-bar" style="width:${pct}%"></div></div>  
  <small>${done}/${total}days</small>  
  <canvas id="pie-${i}" height="100"></canvas>  
  <canvas id="bar-${i}" height="100"></canvas>  
  <div class="card-buttons">  
    <button class="open-btn" onclick="openTab('${tab}')">Open</button>  
    <button class="reset-btn" onclick="resetTracker('${tab}')">Reset</button>  
  </div>  
`;  
    grid.appendChild(card);    
    setTimeout(()=>{    
      const pctx=document.getElementById(`pie-${i}`).getContext('2d');    
      new Chart(pctx,{type:'pie',data:{labels:['Done','Remaining'],datasets:[{data:[done,total-done],backgroundColor:['#10b981','#ef4444']}]},options:{plugins:{legend:{labels:{color:'white'}}}}});    
      const wb=tr.weeks.map(w=>Math.round(w.filter(d=>d.checked).length/w.length*100));    
      const bctx=document.getElementById(`bar-${i}`).getContext('2d');    
      new Chart(bctx,{type:'bar',data:{labels:wb.map((_,idx)=>`W${idx+1}`),datasets:[{label:'%',data:wb,backgroundColor:'#FFC1B7'}]},options:{scales:{x:{ticks:{color:'white'}},y:{ticks:{color:'white'}}},plugins:{legend:{display:false}}}});    
    },50);    
  });    
}    
    
function openTab(tab){currentTab=tab;saveTabs();render();}    
    
function resetTracker(tab) {  
  showModal(  
    'Reset Tracker',  
    `<form>  
       <p>All checkmarks for "${tab}" will be cleared. Continue?</p>  
       <div class="modal-buttons">  
         <button type="submit">Yes</button>  
         <button type="button" class="cancel-btn" onclick="document.getElementById('modalOverlay').style.display='none'">Cancel</button>  
       </div>  
     </form>`,  
    () => {  
      // 1. Uncheck all days  
      allTabs[tab].weeks.forEach(week => {  
        week.forEach(day => {  
          day.checked = false;  
        });  
      });  
        
      // 2. Clear completion flags  
      delete completedTabs[tab];  
      Object.keys(completedWeeks).forEach(key => {  
        if (key.startsWith(tab + "-w")) {  
          delete completedWeeks[key];  
        }  
      });  
        
      // 3. Save & re-render  
      saveTabs();  
      render();  
    }  
  );  
}  
    
function renderTracker() {  
  const tr = allTabs[currentTab];  
  const c = document.getElementById('content');  
  c.innerHTML = '';  
    
  // Calculate overall done and total days  
  const allDays = tr.weeks.flat();  
  const doneTotal = allDays.filter(d => d.checked).length;  
  const totalDays = allDays.length;  
    
  // Create top info container  
  const infoDiv = document.createElement('div');  
  infoDiv.style.display = 'flex';  
  infoDiv.style.flexDirection = 'column';  
  infoDiv.style.alignItems = 'flex-start';  
  infoDiv.style.marginBottom = '1rem';  
  infoDiv.style.color = 'var(--text-light)'; // respects theme colors  
    
  // Start date line  
  const startDateLine = document.createElement('div');  
  startDateLine.className=''  
  // Extract date string like "08/08/2025"
const dateStr = tr.weeks[0][0].label.match(/\((.*)\)/)[1];
// Split dd/mm/yyyy
const [dd, mm, yyyy] = dateStr.split('/');
// Create valid date object
const startDate = new Date(yyyy, mm - 1, dd);
startDateLine.textContent = `Start Date: ${startDate.toLocaleDateString('en-GB')}`;
  startDateLine.style.fontWeight = 'bold';  
  infoDiv.appendChild(startDateLine);  
    
  // Overall completion fraction line  
  const overallProgressLine = document.createElement('div');  
  overallProgressLine.textContent = `${doneTotal} / ${totalDays} days completed`;  
  overallProgressLine.style.marginTop = '0.5rem';  
  overallProgressLine.style.fontWeight = 'bold';  
  infoDiv.appendChild(overallProgressLine);  
    
  // Separator line  
  const separator = document.createElement('hr');  
  separator.style.width = '100%';  
  separator.style.borderColor = '#999';  
  separator.style.margin = '0.7rem 0';  
  infoDiv.appendChild(separator);  
    
    
    
    
  infoDiv.style.color = 'var(--text-primary)';  
  overallProgressLine.style.color = 'var(--text-primary)';  
separator.style.borderColor = 'var(--separator-color)';  
  
    
c.appendChild(infoDiv);  
    
  // Render each week  
  tr.weeks.forEach((week, wi) => {  
    const title = document.createElement('div');  
    title.className = 'week-title';  
    title.textContent = `Week ${wi + 1} – ${tr.topic}`;  
    c.appendChild(title);  
      
    // Weekly done and total  
    const done = week.filter(d => d.checked).length;  
    const tot = week.length;  
      
    // Progress bar container  
    const pc = document.createElement('div');  
    pc.className = 'progress-container';  
      
    // Progress bar  
    const pb = document.createElement('div');  
    pb.className = 'progress-bar';  
    pb.style.width = `${Math.round(done / tot * 100)}%`;  
    pc.appendChild(pb);  
    c.appendChild(pc);  
      
    // Weekly completion fraction (like 2/7 days)  
    const prc = document.createElement('div');  
    prc.style.width = 'auto';  
    prc.style.height = 'auto';  
    prc.style.display = 'flex';  
    prc.style.padding = '0.3rem 0.8rem';  
    prc.style.alignItems = 'center';  
    prc.style.justifyContent = 'center';  
    prc.style.fontWeight = 'bold';  
    prc.style.margin = '3px';  
    prc.textContent = `${done} / ${tot} days completed`;  
    pc.after(prc);  
      
      
      
      
    // Render each day checkbox  
    week.forEach(day => {  
      const label = document.createElement('label');  
      label.className = 'checkbox';  
        
      const cb = document.createElement('input');  
      cb.type = 'checkbox';  
      cb.checked = day.checked;  
      cb.onchange = () => {
  if (!day.checked) { // Allow checking only if not already checked
    day.checked = true;
    saveTabs();
    checkCelebrations(tr);
    render();
  } else {
    cb.checked = true; // Prevent unchecking by resetting it to checked
  }
};
        
      const mark = document.createElement('span');  
      mark.className = 'checkmark';  
      mark.innerHTML = '<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>';  
        
      label.append(cb, mark, document.createTextNode(day.label));  
      c.appendChild(label);  
    });  
  });  
}  
    
// Export / Import    
function exportData(){    
  const blob=new Blob([JSON.stringify({allTabs,completedWeeks,completedTabs})],{type:'application/json'});    
  const url=URL.createObjectURL(blob);    
  const a=document.createElement('a');    
  a.href=url;a.download='day-tracker-data.json';a.click();    
  URL.revokeObjectURL(url);    
}    
function importData(){    
  const inp=document.createElement('input');    
  inp.type='file';    
  inp.accept='.json';    
  inp.onchange=()=>{    
    const file=inp.files[0];    
    if(!file) return;    
    const reader=new FileReader();    
    reader.onload=()=>{    
      try{    
        const data=JSON.parse(reader.result);    
        if(data.allTabs) allTabs=data.allTabs;    
        if(data.completedWeeks) completedWeeks=data.completedWeeks;    
        if(data.completedTabs) completedTabs=data.completedTabs;    
        saveTabs();    
        render();    
      }catch(e){alert('Invalid file');}    
    };    
    reader.readAsText(file);    
  };    
  inp.click();    
}    
    
// Main render    
function render(){    
  renderTabs();    
  if(currentTab==='Dashboard'){    
    document.getElementById('resetBtn').style.display='none';    
    renderDashboard();    
  } else {    
    document.getElementById('resetBtn').style='display:flex;flex-direction:column';    
    document.getElementById('resetBtn').onclick=()=>resetTracker(currentTab);    
    renderTracker();    
  }    
}    
    



// Remove creation of plus button inside renderTabs

// Instead, after renderTabs(), add this event listener once:
document.getElementById('addTabBtn').onclick = () => {
  showModal('New Tab', `
    <form>
      <div class="form-group"><input name="tabName" required><label>Tab name</label></div>
      <div class="form-group"><input name="topic" required><label>Topic name</label></div>
      <div class="form-group"><input type="number" name="days" min="1" required><label>Total days</label></div>
      <div class="form-group"><input type="date" name="startDate" required><label>Start date</label></div>
      <div class="modal-buttons">
        <button type="button" class="cancel-btn" onclick="document.getElementById('modalOverlay').style.display='none'">Cancel</button>
        <button type="submit">Create</button>
      </div>
    </form>`, fd => {
    const n = fd.get('tabName');
    if (allTabs[n]) return alert('Exists');
    allTabs[n] = createTrackerData(fd);
    currentTab = n;
    saveTabs();
    render();
  });
};



// Start app    
render();
</script>  </body>  
</html>  
